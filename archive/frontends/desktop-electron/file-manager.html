<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toobix File Manager</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a0e1a 0%, #1a1f3a 100%);
      color: #fff;
      overflow: hidden;
      height: 100vh;
    }

    .container {
      display: flex;
      height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background: rgba(20, 20, 40, 0.8);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #9D4EDD, #4CC9F0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-button {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      text-align: left;
    }

    .nav-button:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }

    .nav-button.active {
      background: linear-gradient(135deg, #9D4EDD, #4CC9F0);
      border-color: transparent;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 32px;
      background: linear-gradient(135deg, #9D4EDD, #4CC9F0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .luna-input {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
    }

    .luna-input input {
      flex: 1;
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
    }

    .luna-input input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .luna-input button {
      padding: 15px 30px;
      background: linear-gradient(135deg, #9D4EDD, #4CC9F0);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .luna-input button:hover {
      transform: scale(1.05);
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
    }

    .card h2 {
      margin-bottom: 15px;
      font-size: 20px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }

    button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .file-list {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .file-item {
      padding: 10px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .category-group {
      margin-bottom: 20px;
    }

    .category-header {
      font-weight: bold;
      margin-bottom: 10px;
      padding: 8px 12px;
      background: linear-gradient(135deg, #9D4EDD, #4CC9F0);
      border-radius: 6px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      opacity: 0.6;
    }

    .success {
      color: #06FFA5;
    }

    .error {
      color: #FF006E;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo">üóÇÔ∏è Toobix Files</div>
      <button class="nav-button active" data-view="organize">üìä Organize</button>
      <button class="nav-button" data-view="duplicates">üîç Find Duplicates</button>
      <button class="nav-button" data-view="programs">üöÄ Programs</button>
      <button class="nav-button" data-view="luna">üåô Luna Commands</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h1>File Manager</h1>
        <button onclick="selectFolder()">üìÅ Select Folder</button>
      </div>

      <!-- Luna Command Input -->
      <div class="luna-input">
        <input
          type="text"
          id="luna-command"
          placeholder='üåô Ask Luna: "organize my downloads", "find duplicates", "close distractions"...'
          onkeypress="if(event.key === 'Enter') sendLunaCommand()"
        />
        <button onclick="sendLunaCommand()">Send</button>
      </div>

      <!-- Dynamic Content -->
      <div id="content">
        <div class="card">
          <h2>Welcome to Toobix File Manager!</h2>
          <p>Select a folder to get started, or ask Luna for help.</p>
          <div class="button-group">
            <button onclick="selectFolder()">üìÅ Select Folder</button>
            <button onclick="quickOrganize('downloads')">üì• Organize Downloads</button>
            <button onclick="quickOrganize('desktop')">üñ•Ô∏è Organize Desktop</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentFolder = null
    let currentPlan = null

    // Select folder
    async function selectFolder() {
      const folder = await window.fileManager.selectFolder()
      if (folder) {
        currentFolder = folder
        showContent('organize')
        scanFolder(folder)
      }
    }

    // Quick organize
    function quickOrganize(location) {
      const paths = {
        downloads: process.env.USERPROFILE + '\\Downloads',
        desktop: process.env.USERPROFILE + '\\Desktop',
      }
      currentFolder = paths[location]
      scanFolder(currentFolder)
    }

    // Scan folder
    async function scanFolder(folder) {
      const content = document.getElementById('content')
      content.innerHTML = '<div class="loading">üîç Scanning folder...</div>'

      const result = await window.fileManager.scanDirectory(folder)

      if (!result.success) {
        content.innerHTML = `<div class="card error">‚ùå Error: ${result.error}</div>`
        return
      }

      const files = result.files
      content.innerHTML = `
        <div class="card">
          <h2>Scan Results: ${folder}</h2>
          <p>Found <strong>${files.length}</strong> files</p>
          <div class="button-group">
            <button onclick="organizeFolder()">üìä Organize Files</button>
            <button onclick="findDuplicates()">üîç Find Duplicates</button>
          </div>
        </div>
      `
    }

    // Organize folder
    async function organizeFolder() {
      const content = document.getElementById('content')
      content.innerHTML = '<div class="loading">üß† AI is analyzing files...</div>'

      const result = await window.fileManager.organizeDirectory(currentFolder)

      if (!result.success) {
        content.innerHTML = `<div class="card error">‚ùå Error: ${result.error}</div>`
        return
      }

      currentPlan = result.plan
      displayOrganizationPlan(result.plan)
    }

    // Display organization plan
    function displayOrganizationPlan(plan) {
      const content = document.getElementById('content')
      const categories = Object.entries(plan.structure)

      let html = `
        <div class="card">
          <h2>üìä Organization Plan</h2>
          <p>${plan.reasoning}</p>
          <div class="button-group">
            <button onclick="executePlan()" class="success">‚úÖ Execute Plan</button>
            <button onclick="scanFolder(currentFolder)">‚ùå Cancel</button>
          </div>
        </div>
      `

      categories.forEach(([category, files]) => {
        html += `
          <div class="card category-group">
            <div class="category-header">üìÅ ${category} (${files.length} files)</div>
            <div class="file-list">
              ${files.slice(0, 10).map(f => `
                <div class="file-item">
                  <span>${f.split('\\').pop()}</span>
                </div>
              `).join('')}
              ${files.length > 10 ? `<p>... and ${files.length - 10} more</p>` : ''}
            </div>
          </div>
        `
      })

      content.innerHTML = html
    }

    // Execute plan
    async function executePlan() {
      const content = document.getElementById('content')
      content.innerHTML = '<div class="loading">‚ö° Organizing files...</div>'

      const result = await window.fileManager.executePlan(currentFolder, currentPlan)

      if (result.success) {
        content.innerHTML = `
          <div class="card success">
            <h2>‚úÖ Organization Complete!</h2>
            <p>Files have been organized into categories.</p>
            <button onclick="scanFolder(currentFolder)">üîÑ Scan Again</button>
          </div>
        `
      } else {
        content.innerHTML = `<div class="card error">‚ùå Error: ${result.error}</div>`
      }
    }

    // Find duplicates
    async function findDuplicates() {
      const content = document.getElementById('content')
      content.innerHTML = '<div class="loading">üîç Scanning for duplicates...</div>'

      const result = await window.fileManager.findDuplicates(currentFolder)

      if (!result.success) {
        content.innerHTML = `<div class="card error">‚ùå Error: ${result.error}</div>`
        return
      }

      if (result.duplicates.length === 0) {
        content.innerHTML = `
          <div class="card success">
            <h2>‚ú® No Duplicates Found!</h2>
            <p>Your folder is clean.</p>
          </div>
        `
        return
      }

      let html = `
        <div class="card">
          <h2>üîç Found ${result.duplicates.length} Duplicate Groups</h2>
        </div>
      `

      result.duplicates.forEach((group, i) => {
        html += `
          <div class="card">
            <h3>Group ${i + 1}</h3>
            <div class="file-list">
              ${group.files.map(f => `
                <div class="file-item">
                  <span>${f.name}</span>
                  <span>${formatBytes(f.size)}</span>
                </div>
              `).join('')}
            </div>
          </div>
        `
      })

      content.innerHTML = html
    }

    // Luna command
    async function sendLunaCommand() {
      const input = document.getElementById('luna-command')
      const command = input.value.trim()

      if (!command) return

      const content = document.getElementById('content')
      content.innerHTML = '<div class="loading">üåô Luna is thinking...</div>'

      const result = await window.fileManager.lunaCommand(command)

      if (result.success) {
        content.innerHTML = `
          <div class="card success">
            <h2>üåô Luna's Response</h2>
            <p>${result.response}</p>
          </div>
        `
      } else {
        content.innerHTML = `<div class="card error">‚ùå Error: ${result.error}</div>`
      }

      input.value = ''
    }

    // Navigation
    document.querySelectorAll('.nav-button').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'))
        button.classList.add('active')
        showContent(button.dataset.view)
      })
    })

    function showContent(view) {
      // TODO: Implement different views
    }

    function formatBytes(bytes) {
      if (bytes < 1024) return bytes + ' B'
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB'
      if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB'
      return (bytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB'
    }
  </script>
</body>
</html>
