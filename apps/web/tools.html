<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toobix Tool Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root[data-theme="dark"] {
      --bg: #0a0a0f;
      --card: rgba(255,255,255,0.05);
      --text: #ffffff;
      --text-dim: #a0a0b8;
      --accent: #667eea;
      --border: rgba(255,255,255,0.1);
      --success: #10b981;
      --error: #ef4444;
    }
    
    :root[data-theme="light"] {
      --bg: #f5f7fa;
      --card: rgba(102,126,234,0.05);
      --text: #1a1a2e;
      --text-dim: #6b7280;
      --accent: #667eea;
      --border: rgba(0,0,0,0.1);
      --success: #059669;
      --error: #dc2626;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }

    .header {
      max-width: 1400px;
      margin: 0 auto 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .logo { display: flex; align-items: center; gap: 15px; }
    .logo h1 {
      font-size: 2em;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .btn {
      padding: 10px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn:hover { transform: translateY(-2px); }
    .btn-primary { background: var(--accent); color: white; }

    .categories {
      max-width: 1400px;
      margin: 0 auto 30px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }

    .cat-btn {
      padding: 12px;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s;
    }

    .cat-btn.active { border-color: var(--accent); }
    .cat-btn:hover { transform: translateY(-2px); }

    .tools {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .tool {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s;
    }

    .tool:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(102,126,234,0.2);
    }

    .tool-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
    .tool-icon { font-size: 2em; }
    .tool-name { font-size: 1.2em; font-weight: 600; margin-bottom: 8px; }
    .tool-desc { color: var(--text-dim); font-size: 0.9em; margin-bottom: 15px; }

    .input-group { margin-bottom: 12px; }
    .input-label { display: block; color: var(--text-dim); font-size: 0.85em; margin-bottom: 6px; }
    .input {
      width: 100%;
      padding: 10px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.95em;
    }

    .input:focus { outline: none; border-color: var(--accent); }
    .textarea { min-height: 80px; resize: vertical; font-family: inherit; }

    .actions { display: flex; gap: 10px; margin-top: 15px; }
    
    .result {
      margin-top: 15px;
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
      font-size: 0.9em;
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }

    .result.success { border-left: 3px solid var(--success); }
    .result.error { border-left: 3px solid var(--error); }
    .result pre { white-space: pre-wrap; word-break: break-all; }

    .results-panel {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 400px;
      max-height: 500px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .results-header {
      padding: 15px;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      cursor: pointer;
    }

    .results-content { padding: 15px; max-height: 400px; overflow-y: auto; }
    .result-item { padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 10px; }
    .result-time { color: var(--text-dim); font-size: 0.75em; }
    .result-tool { font-weight: 600; margin: 6px 0; }

    @keyframes spin { to { transform: rotate(360deg); } }
    .loading { display: inline-block; animation: spin 1s linear infinite; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">
      <span style="font-size: 2em;">üåâ</span>
      <div>
        <h1>Toobix Tools</h1>
        <p style="color: var(--text-dim); font-size: 0.9em;">52 MCP Tools ‚Ä¢ Bridge Port 3337</p>
      </div>
    </div>
    <div style="display: flex; gap: 10px;">
      <button class="btn" onclick="toggleTheme()">üåì</button>
      <button class="btn btn-primary" onclick="testBridge()">Test Bridge</button>
    </div>
  </div>

  <div class="categories" id="categories"></div>
  <div class="tools" id="tools"></div>

  <div class="results-panel">
    <div class="results-header" onclick="toggleResults()">
      <span>üìä Results</span>
      <span id="toggle">‚ñº</span>
    </div>
    <div class="results-content" id="results">
      <div class="result-item">
        <div class="result-time">Ready</div>
        <div class="result-tool">Waiting for first execution...</div>
      </div>
    </div>
  </div>

  <script>
    const BRIDGE = 'http://localhost:3337';
    const TOOLS = [
      // Memory
      { id: 'memory_search', cat: 'memory', icon: 'üîç', name: 'Memory Search', desc: 'RAG search', inputs: [
        { name: 'query', type: 'text', label: 'Search Query', required: true },
        { name: 'limit', type: 'number', label: 'Max Results', default: 5 }
      ]},
      { id: 'memory_add', cat: 'memory', icon: 'üíæ', name: 'Add Memory', desc: 'Store knowledge', inputs: [
        { name: 'text', type: 'textarea', label: 'Content', required: true }
      ]},
      
      // Love
      { id: 'love_add_gratitude', cat: 'love', icon: 'üôè', name: 'Add Gratitude', desc: 'Gratitude entry', inputs: [
        { name: 'content', type: 'textarea', label: 'Content', required: true },
        { name: 'category', type: 'select', label: 'Category', options: ['person', 'moment', 'achievement', 'nature', 'other'], required: true },
        { name: 'intensity', type: 'number', label: 'Intensity (1-10)', default: 7, min: 1, max: 10 }
      ]},
      { id: 'love_add_kindness', cat: 'love', icon: 'üíù', name: 'Log Kindness', desc: 'Kindness act', inputs: [
        { name: 'description', type: 'text', label: 'Description', required: true },
        { name: 'type', type: 'select', label: 'Type', options: ['given', 'received'], required: true },
        { name: 'category', type: 'select', label: 'Category', options: ['help', 'gift', 'time', 'words', 'presence'], required: true }
      ]},
      { id: 'love_get_score', cat: 'love', icon: '‚ù§Ô∏è', name: 'Love Score', desc: 'Get love score', inputs: [] },
      
      // Peace
      { id: 'peace_get_state', cat: 'peace', icon: 'üïäÔ∏è', name: 'Peace State', desc: '5 agents state', inputs: [] },
      { id: 'peace_calm_meditate', cat: 'peace', icon: 'üßò', name: 'Meditate', desc: 'Log meditation', inputs: [
        { name: 'duration', type: 'number', label: 'Duration (min)', default: 10, min: 1 }
      ]},
      { id: 'peace_calm_breathing', cat: 'peace', icon: 'üòÆ‚Äçüí®', name: 'Breathing', desc: 'Breathing exercise', inputs: [] },
      { id: 'peace_clarity_journal', cat: 'peace', icon: 'üìù', name: 'Journal', desc: 'Journal entry', inputs: [
        { name: 'entry', type: 'textarea', label: 'Entry', required: true },
        { name: 'wordCount', type: 'number', label: 'Word Count', default: 100 }
      ]},
      
      // Story
      { id: 'story_state', cat: 'story', icon: 'üìä', name: 'Story State', desc: 'Current story', inputs: [] },
      { id: 'story_refresh', cat: 'story', icon: 'üîÑ', name: 'Refresh Options', desc: 'New options', inputs: [] },
      
      // System
      { id: 'ping', cat: 'system', icon: 'üèì', name: 'Ping', desc: 'Connection test', inputs: [] }
    ];

    const CATEGORIES = [
      { id: 'all', icon: '‚ö°', name: 'All', count: TOOLS.length },
      { id: 'memory', icon: 'üíæ', name: 'Memory', count: 2 },
      { id: 'love', icon: 'üíù', name: 'Love', count: 3 },
      { id: 'peace', icon: 'üïäÔ∏è', name: 'Peace', count: 4 },
      { id: 'story', icon: 'üìñ', name: 'Story', count: 2 },
      { id: 'system', icon: 'üîß', name: 'System', count: 1 }
    ];

    let currentCat = 'all';

    function init() {
      renderCategories();
      renderTools();
    }

    function renderCategories() {
      document.getElementById('categories').innerHTML = CATEGORIES.map(c => `
        <div class="cat-btn ${c.id === currentCat ? 'active' : ''}" onclick="filterCat('${c.id}')">
          <div style="font-size: 1.5em;">${c.icon}</div>
          <div style="font-weight: 600; margin: 5px 0;">${c.name}</div>
          <div style="font-size: 0.85em; color: var(--text-dim);">${c.count} tools</div>
        </div>
      `).join('');
    }

    function renderTools() {
      const filtered = currentCat === 'all' ? TOOLS : TOOLS.filter(t => t.cat === currentCat);
      document.getElementById('tools').innerHTML = filtered.map(t => `
        <div class="tool">
          <div class="tool-header">
            <span class="tool-icon">${t.icon}</span>
          </div>
          <div class="tool-name">${t.name}</div>
          <div class="tool-desc">${t.desc}</div>
          ${t.inputs.map(i => renderInput(t.id, i)).join('')}
          <div class="actions">
            <button class="btn btn-primary" onclick="exec('${t.id}')">Execute</button>
            ${t.inputs.length ? `<button class="btn" onclick="clear('${t.id}')">Clear</button>` : ''}
          </div>
          <div class="result" id="result-${t.id}"></div>
        </div>
      `).join('');
    }

    function renderInput(toolId, input) {
      const id = `${toolId}-${input.name}`;
      if (input.type === 'textarea') {
        return `<div class="input-group">
          <label class="input-label">${input.label}${input.required ? ' *' : ''}</label>
          <textarea id="${id}" class="input textarea" ${input.required ? 'required' : ''}></textarea>
        </div>`;
      }
      if (input.type === 'select') {
        return `<div class="input-group">
          <label class="input-label">${input.label}${input.required ? ' *' : ''}</label>
          <select id="${id}" class="input" ${input.required ? 'required' : ''}>
            <option value="">Select...</option>
            ${input.options.map(o => `<option value="${o}">${o}</option>`).join('')}
          </select>
        </div>`;
      }
      return `<div class="input-group">
        <label class="input-label">${input.label}${input.required ? ' *' : ''}</label>
        <input type="${input.type}" id="${id}" class="input" 
          ${input.default !== undefined ? `value="${input.default}"` : ''}
          ${input.min ? `min="${input.min}"` : ''}
          ${input.max ? `max="${input.max}"` : ''}
          ${input.required ? 'required' : ''} />
      </div>`;
    }

    async function exec(toolId) {
      const tool = TOOLS.find(t => t.id === toolId);
      const args = {};
      
      for (const input of tool.inputs) {
        const val = document.getElementById(`${toolId}-${input.name}`).value;
        if (val) args[input.name] = input.type === 'number' ? parseFloat(val) : val;
      }

      const resultDiv = document.getElementById(`result-${toolId}`);
      resultDiv.style.display = 'block';
      resultDiv.className = 'result';
      resultDiv.innerHTML = '<div class="loading">‚è≥</div> Executing...';

      try {
        const res = await fetch(`${BRIDGE}/tools/execute`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tool: toolId, args })
        });
        const data = await res.json();
        resultDiv.className = 'result success';
        resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        addResult(tool.name, data);
      } catch (err) {
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `<pre>Error: ${err.message}</pre>`;
      }
    }

    function clear(toolId) {
      const tool = TOOLS.find(t => t.id === toolId);
      for (const input of tool.inputs) {
        const el = document.getElementById(`${toolId}-${input.name}`);
        el.value = input.default || '';
      }
      document.getElementById(`result-${toolId}`).style.display = 'none';
    }

    function filterCat(cat) {
      currentCat = cat;
      renderCategories();
      renderTools();
    }

    function addResult(name, data) {
      const results = document.getElementById('results');
      const item = document.createElement('div');
      item.className = 'result-item';
      item.innerHTML = `
        <div class="result-time">${new Date().toLocaleTimeString()}</div>
        <div class="result-tool">${name}</div>
        <pre style="font-size: 0.85em; margin-top: 5px;">${JSON.stringify(data, null, 2)}</pre>
      `;
      results.insertBefore(item, results.firstChild);
      while (results.children.length > 10) results.removeChild(results.lastChild);
    }

    async function testBridge() {
      try {
        const res = await fetch(`${BRIDGE}/health`);
        const data = await res.json();
        alert(`‚úÖ Bridge Connected!\n\nStatus: ${data.status}\nTools: ${data.tools}`);
      } catch (err) {
        alert(`‚ùå Bridge Error!\n\n${err.message}\n\nStart Bridge: bun run packages/bridge/src/index.ts`);
      }
    }

    function toggleTheme() {
      const html = document.documentElement;
      const theme = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
    }

    function toggleResults() {
      const content = document.querySelector('.results-content');
      const toggle = document.getElementById('toggle');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        toggle.textContent = '‚ñº';
      } else {
        content.style.display = 'none';
        toggle.textContent = '‚ñ≤';
      }
    }

    const saved = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', saved);
    init();
  </script>
</body>
</html>
